# 無齡診所IT系統設計規格書(合約版)xxx

## 

![horizontal line](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image1.png)

![無齡診所4+2R](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image5.jpg)

無齡IT系統設計規格書

(暨同驗收標準)

無齡診所

台北市大安區敦化南路1段259號13樓

| **版本/產出日期** | **異動說明** | **負責人員** | **審查人員** |
| --- | --- | --- | --- |
| Ｖ1.0 / 2024.Jun.14 | 初版 | Peter.Hsu | - |
| Ｖ1.1 / 2024.Jun.17 | 加入高併發問題
加入OAuth 2.0機制
加入播放器功能 | Peter.Hsu | - |
| Ｖ1.2 / 2024.Jun.18 | 加入Elastic Loading Blancing
加入K8S專案部署 | Peter.Hsu | - |
| Ｖ1.2 / 2024.Jun.19 | 加入UI/UX規範 | Peter.Hsu | - |
| Ｖ1.3 / 2024.Jun.22 | 加入當前問題簡述
加入外包商要求 | Peter.Hsu | - |
| Ｖ1.3.1 / 2024.Jun.24 | 修正DQA相關 | Peter.Hsu | - |
| Ｖ1.3.2 / 2024.Jun.26 | App動畫加入lottie
修正必要配合的技術 | Peter.Hsu | - |
| V 1.3.3 /
2024.July.09 | 修正unitTest條件(前後端分開) | Peter.Hsu | - |
| V 1.3.4 /
2024.July.11 | 移除專案管理 | Peter.Hsu | - |
| V 1.3.5 /
2024.July.12 | 放寬後端api開發選項 | Peter.Hsu | - |
| V 1.4.0 /
2024.July.18 | 加入前端網頁開發項目 | Peter.Hsu | - |
| V 1.4.1 /
2024.July.30 | 1.Web前端, 後端, CMS, 統一以JavaScript為共通技術
2.修正細項說明 | Peter.Hsu | - |
| V 1.4.2 /
2024.August.01 | 1.補充Web RWD說明
2.加入Django的相對Node.js框架選項
3.更新會員分級說明
4.延後MileStones | Peter.Hsu | - |
| V 1.4.3 /
2024.August.03 | 新增播放器功能(預防螢幕錄影截圖),播放器功能調整 | Peter.Hsu | - |
| V 1.4.4 /
2024.August.08 | App設定功能頁新增生物辨識功能開關 | Peter.Hsu | - |
| V 1.4.5 /
2024.August.09 | 1.補充後端api要有分頁機制,並且要有明確的錯誤訊息
2.回填Git Flow範例 | Peter.Hsu | - |
| V 1.4.6 /
2024.August.10 | 加入資安重點規範 | Peter.Hsu | - |
| V 1.4.7 /
2024.August.17 | 1. [加入頁面功能文件](https://docs.google.com/spreadsheets/d/1B1r2tLhK41xS1RSBLGmWuq-pdEtAD-E8XT8UTLn1qP4/edit?gid=0#gid=0)(p.17)
2. App加載效果使用[shimmer](https://pub.dev/packages/shimmer)
3. AWS EKS替代K8S部署 | Peter.Hsu | - |
| V 1.4.8 /
2024.Sep.06 | 遺補缺項
1. 英文版網站
2. 各規範文件連結 | Peter.Hsu | - |
| V 1.4.9 /
2024.Sep.11 | 1.刪除UnitTest(同合約)
2.新增App支援亮暗模式 | Peter.Hsu | - |
| V 1.5.0 /
2024.Sep.13 | 刪除劃上刪除線的部分 | Peter.Hsu | - |
| V 1.5.1 /
2024.Sep.14 | 新增電子病例說明 | Peter.Hsu |  |
| V 1.5.2 /
2024.Oct.01 | 1. 修正iOS可執行最低版本
2. 修正MileStone日期 | Peter.Hsu |  |
| V 1.5.3 /
2024.Oct.04 | 修正網頁前端狀態處理工具由Vuex換Pinia | Peter.Hsu |  |
| V 1.5.4 /
2024.Oct.24 | 1.新增與刪除sitemap的圖片
2.DB新增PostgreSQL選項
3.AWS補上ECR服務
4.會員權限 - 待更新
5.SEO優化 - 說明待補充 | Peter.Hsu |  |
| V 1.5.5 /
2024.Oct.29 | 修正新的開發時程表 | Peter.Hsu |  |
| V 1.5.6 /
2024.Oct.30 | 修正會員分級規則
新增生物辨識說明 | Peter.Hsu |  |
| V 1.5.7 /
2025.Jan.20 | 收款階段圖示修正 | Peter.Hsu |  |

# 

# 概述：

本規格書旨在解決診所看診會員和櫃檯人員在預約、資料管理等方面的困擾，通過開發一個功能全面的IT系統來提升服務質量和運營效率。

# 當前的問題：

# 手動作業流程:

# 會員驗證和購買限額是手動管理的。

# 每次購買都需要根據會員資格和先前的購買情況進行人工驗證。

# 由於手動工作量，行銷活動可能會讓員工不堪重負。

# 預約要透過表格和訊息手動處理。

# 線上課程後台，商線科技後台，出貨系統SimPos後台，各自獨立。

# 會員分級 :

１．未註冊：

ＷＥＢ：可最新消息、關於我們、服務項目、衛教新知、聯絡我們。**不可線上課程、 線上商城、會員專區**ＡＰＰ：**全都不可使用**

２．註冊會員（註冊後自動開啟）：

ＷＥＢ：可察看基本日記、購買課程、商城下單、預約課程。**還不可預約看診、觀看課程**

ＡＰＰ：可記錄基本日記、購買課程、商城下單、預約課程、最新消息、關於我們、服務項目、衛教新知、聯絡我們。**還不可預約看診、觀看課程**

３．課程會員（課程付費後自動開啟）：

ＷＥＢ：可觀看課程、觀看完整日記，可預約看診。**還不可購買ＭＮＴ及套組**

ＡＰＰ：可觀看課程、紀錄完整日記，可預約看診。**還不可購買ＭＮＴ及套組**

４．看診會員（看診後手動開啟）：

ＷＥＢ：開放商城可購買ＭＮＴ及套組，可累積點數。

ＡＰＰ：開放商城可購買ＭＮＴ及套組，可累積點數。

５．訂閱會員：（訂閱後手動開啟）

ＷＥＢ：可預約營養師及其他服務。

ＡＰＰ：可預約營養師及其他服務。

# 3.諮商前教育:

# 患者在看醫生之前必須完成線上課程，以確保他們理解並信任診所的方法。(這系統很慢)

# 目標

1. 整合以下網站裡的資料，建立資料庫並部署到AWS(ECR + S3 + EC2 + ELB + EKS):
- **雲新健康科技(買影音課程/團隊介紹):** [**https://nct.eletang.com.tw/?m=Homepage&c=Index&a=index**](https://nct.eletang.com.tw/?m=Homepage&c=Index&a=index)
- **Shopline(電子商城):** [**https://amortality.shoplineapp.com/**](https://amortality.shoplineapp.com/)
- **SIMPOS(客戶資料/訂單/庫存/發票/商品管理/店員用的系統):** [**https://www.simpos.com.tw/one-pager**](https://www.simpos.com.tw/one-pager)
1. 開發跨平台的App，包括iOS、Android、~~Web~~和CMS內容管理系統。

**CMS作業後台截圖(由於個資法: 請來信申請權限 - 可要求更多截圖，或現場開會觀看)：**[https://drive.google.com/drive/folders/1ODlSJocvESAzxebjgf1mS-obNSv8wlB_?usp=sharing](https://drive.google.com/drive/folders/1ODlSJocvESAzxebjgf1mS-obNSv8wlB_?usp=sharing)**CMS 會用到的功能：**

- 開通課程
- 訂單管理
1. 訂單可以單扣出貨, 比如一筆訂單裡，買了暢便輕三個，客人兩個要用寄的，一個先自取，那出貨人員就要可以先出貨一個暢便輕，等於說這一筆訂單就是有寄送也有自取
    
    圖例:
    
    ![](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image6.jpg)
    
2. 買三個，自取一個的圖例
    
    ![](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image7.jpg)
    
- 折扣碼
- 學習進度(課程看到哪裡)
- 發票管理
- 商品及分類
- 庫存管理
- 客戶管理
- 促銷及分潤
- 報表及分析(要分**線上商城**跟**診所現場**的)
1. 每日營收
2. 業績報表
3. 月營收表
4. 庫存報表

圖例：

![](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image3.jpg)

- 網店設計
- 設定
- 標籤功能(訂單和客戶都需要有標籤)
- 管理員: LV1(所有功能) / LV2 會計,出貨(可以匯總) / LV3 店員(看訂單, 不能匯總) / LV4 Part Time (建立訂單)

# 設計需求 :

**App 開發語言**：Flutter 3.22.1 / Dart SDK: 3.4.3

**App 相容性** : iOS(15+), Android(10+), ~~Web(Wasm support)~~, iPadOS(15+)

**App 使用工具** :

- 狀態管理，頁面導航: [getx](https://pub.dev/packages/get)
- 網路請求: dio
- 圖片加載: cached_network_image
- Log: Logger
- Data Model: freezed
- Data secure: flutter_secure_storage
- 元件加載效果: [shimmer](https://pub.dev/packages/shimmer)
- Animations: lottie, animations, animated_text_kit
- 啟用混淆Obfuscation:
    
    [參考或提供合適方案>>
    
    Dart: --obfuscate 和 --split-debug-info 選項,
    
    Java/Kotlin: Proguard & R8,
    
    Swift: SwiftShield]
    
- App要支援手機亮暗模式
- 生物辨識說明: 打開app後，如果已經註冊過，生物辨識功能也是開啟，則可以快速登入app

**版本控制**：遵循gitflow原則，commit粒度以1個邏輯上的改動為單位，commit message必須寫成有意義的句子

**CMS開發：(Strapi + Node.js手動客製化 )**

- JavaScript + Node.js + [Strapi](https://strapi.io/) (詳細請點連結)
- 資安: 避免被SQL injection

**CMS要求 : strapi 付費企業版功能中的 "用戶角色和權限" 和 "多租戶支持"。用免費社群版, 請手動寫code去達成付費版的功能, 實作後如果無法實現, 請告訴我程式在哪裡出問題.
以下chatGPT說明:**

![](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image8.png)

**前端開發：**

- 開發語言: HTML5 / CSS3 / JavaScript(ES6+)

### 前端框架及工具

- **框架**:
    - Vue.js
- **狀態管理**:
    - pinia (Vue.js)
- **打包工具**:
    - Webpack 或 Vite
- **CSS 預處理器**:
    - SASS/SCSS 或 Less
- **UI 框架**:
    - Tailwind CSS 或 Bootstrap
- 設計需求：

> RWD(手機和Desktop網頁):
> 
- **用戶界面設計（User Interface Design）：**這部分應該詳細說明界面設計的原則和方法，包括RWD的設計原則，如何通過CSS媒體查詢和彈性佈局來實現不同設備上的自適應。
- **功能需求（Functional Requirements）：**如果RWD設計涉及到特定的功能需求，比如在不同屏幕尺寸下需要顯示或隱藏某些元素，這些需求應該明確地寫在功能需求部分。
- **非功能需求(Non-Functional Requirements)：**RWD設計通常也會涉及到性能和可用性方面的非功能需求，比如頁面的加載時間在不同設備上的表現、用戶體驗的一致性等。
- **設計規範（Design Guidelines）：**這一部分可以包括具體的設計規範和標準，如網格系統、字體大小、間距、按鈕大小等，確保在各種設備上都能提供良好的使用體驗。

> 響應式設計:
> 
- 使用媒體查詢和彈性布局（Flexbox / Grid）

> 瀏覽器相容性:
> 
- 支持現代主流瀏覽器（Chrome, Firefox, Safari, Edge）
- 英文版網站

> 性能優化:
> 
- 使用圖片壓縮工具（如 ImageOptim）
- 實施程式碼拆分（Code Splitting）
- 使用 Lazy Loading 加載圖片和其他資源

> SEO 優化:
> 
- 使用語義化的 HTML 標籤
- 設置適當的 meta 標籤（標題、描述、關鍵詞）
- 支持 Open Graph 和 Twitter Card

### 前端架構

- 模組化設計:
    - 遵循單一職責原則
    - 使用 ES6 模組系統
- 代碼風格:
    - 遵循一致的代碼風格（可使用 ESLint 和 Prettier）

### 測試與部署

- 測試工具:
    - 單元測試: Jest 或 Mocha
    - E2E 測試: Cypress 或 Selenium

### 資安重點

- 防止使用的技術棧被網路工具(WhatRuns,Wappalyzer)看到
- 使用Content Security Policy(CSP) 防止XSS攻擊
- 使用SamSite Cookie屬性防止Cross-site request forgery
- 使用X-Frame-Options頭 防止頁面坎入iframe 從而防止Clickjacking
- 確保所有輸入都在Server端驗證 避免attacker繞過前端驗證
- 防止惡意文件上傳(限制大小 檔案類型)
- 限制登入嘗試次數 達到上限時使用Captcha或暫時鎖定帳戶
- 記錄和監控前端的異常情況

**後端開發：**

- 開發技術: Node.js or Python
- Web server: Nginx
- GraphQL API
- Api 要有分頁機制
- Api 要有明確的錯誤訊息
- MySQL/PostgreSQL database (with Redis)
- Postman workspaces要share
- Python: 使用Django框架 / Node.js: 使用KOA
- 使用AWS EKS在正式環境進行容器化的專案部署(1. Dynamic scaling 2. Self healing 3. Zero-Downtime Rolling Update 4. Zero-Downtime Rollback)
- 使用AWS ECR存放Docker Image
- 提供.sql檔進行資料庫初始化和操作
- 提供docker image，用於在本地和生產環境中運行應用
- 考慮高併發情況與對應處置(負載均衡/緩存策略/消息對列/監控和日誌...等)
- 資安重點：
    
    - 所有請求都經過用戶身份認證
    
    - 防止過度查詢(Query Depth Limiting): 限制查詢深度, 攻擊者可 能會建構一個深度遞歸查詢，導致伺服器資源耗盡。可以透過限制查詢的最大深度來防止這種攻擊
    
    - 避免批量查詢(Batch Query)濫用: a) 限制查詢數, 防止攻擊者透過發送包含大量欄位或多個查詢的請求來消耗伺服器資源。可以限制每個請求的查詢數。
    
    b) 速率限制 (Rate Limiting)：為 API 設定速率限制，防止同一使用者或 IP 短時間內發送大量請求。
    
    - 隱藏內部實現: 不要在錯誤訊息中洩露內部實現細節，例如堆棧追蹤（stack trace）、資料庫結構等。應該只傳回一般性錯誤訊息給客戶端，避免讓攻擊者取得應用程式的內部細節資訊
    

> - 禁用內省查詢: 在正式環境中應禁用內省（introspection）查詢，以防止攻擊者獲取 API 的詳細架構資訊。這可以透過設置環境變數或在伺服器配置中禁用內省功能來實現。
> 
> 
> - 記錄存取日誌：記錄所有 API 呼叫日誌，包括查詢、變數、使用者 資訊和回應時間，以便偵測異常行為。
> 
> - 查詢快取：快取常見的查詢結果，減少資料庫負載並防止重複攻擊。
> 
> - 設定 CORS：限制跨域請求，確保只有可信任的網域能夠存取GraphQL Api
> 
> - CSRF 防護：透過使用 CSRF 令牌來防止跨站請求偽造攻擊，確保請求確實是來自經過認證的使用者。
> 

**共通性要求：**

- 程式碼需清楚可讀, 模組化設計, Clean Code 架構, 程式碼模組化, 避免過度抽象化與過度封裝
- 後端api未開發完成前，app端要有mock data讓fake api service接
- 會員帳號要可以切換(使用情境: 女兒幫不會使用手機的媽媽買東西，自動創建媽媽新帳號個人資訊須重填，但是購買的商品歸屬於媽媽的帳號。可參考新北校園通app的家長帳號功能)
- Crash report: Firebase Crashlytics / Sentry
- 防debounce 設計
- OAuth 2.0 (for 第三方登入 / Apple Health & Google Fit)
- App播放器: 播放速度調整(0.25, 0.5, 0.75,1.25,1.5,1.75, 2.0倍), 畫質選擇, 背景播放
- App播放器: [播放器偵測螢幕錄影 手機錄影功能失效(參考Udemy)](https://drive.google.com/drive/folders/1489chvD5X4dsFnz_56fHNIRC6xqN1fWo?usp=sharing) 解法(手機版):https://medium.com/litslink/flutter-preventing-screenshots-and-screen-recording-in-the-app-3e6f55d05ee3
- 每一商品都要埋mixpanel監測點
- CI/CD: Jenkins
- CI/CD: unitTest
- 敏感資料，如用戶密碼、個人資訊等使用AES GCM 256 mode加密保護
    
    (使用此網站驗證: https://www.lddgo.net/en/base/class?classID=3)
    
- 中國人要能使用此app(情境: 翻牆後能看youtube, 卻開不了server上的影片, 不能有此狀況)
- App導覽頁要有powerpoint的轉化動畫(請參考[旋動吉他app](https://apps.apple.com/tw/app/%E6%97%8B%E5%8B%95%E5%90%89%E4%BB%96-%E5%90%8C%E6%AD%A5%E5%BD%B1%E9%9F%B3%E7%9A%84%E5%90%89%E4%BB%96%E8%AD%9C%E6%92%AD%E6%94%BE%E5%99%A8/id1109966537)啟動頁)
- App請模擬弱網環境(Network Link Conditioner): time out要有固定秒數, time out時, 畫面不能破損, data要有alternatives, 要有警告視窗提示
- **Git Flow & commit message 範例:**

> 舉例: 實現用戶登入功能
> 
> 
> **1**.初始化功能分支
> 
> git checkout develop
> 
> git pull origin develop
> 
> git checkout -b feature/user-login
> 
> **2.** 設計用戶模型
> 
> git add lib/models/user.dart
> 
> git commit -m "add(dataModel): 新增 User 模型"
> 
> **3.** 構建登入界面
> 
> git add lib/screens/login_screen.dart
> 
> git commit -m "feat(login_UI): 設計登入界面"
> 
> **4.** 添加表單驗證
> 
> git add lib/screens/login_screen.dart
> 
> git commit -m "add(login_form): 添加表單驗證邏輯"
> 
> **5.** 實現用戶認證邏輯
> 
> git add lib/services/auth_service.dart
> 
> git add lib/screens/login_screen.dart
> 
> git commit -m "add(login_auth)實現用戶認證邏輯"
> 
> **6.** 設置登入成功後的導航
> 
> git add lib/screens/login_screen.dart
> 
> git add lib/screens/home_screen.dart
> 
> git commit -m "add(login): 設置登入成功後的導航到主頁"
> 
> **7.** 添加單元測試
> 
> git add test/auth_service_test.dart
> 
> git commit -m "add(login): 為用戶認證邏輯添加單元測試"
> 
> **8.** 更新文件
> 
> git add README.md
> 
> git commit -m "add(readme): 更新 README，添加用戶登入功能的說明"
> 
> 合併功能分支
> 
> 完成所有功能開發後，將 **feature** 分支合併回 **develop** 分支：
> 
> git checkout develop
> 
> git pull origin develop
> 
> git merge feature/user-login
> 
> git push origin develop
> 
> **緊急修復範例：**
> 
> **1.** 創建 **hotfix** 分支
> 
> git checkout main
> 
> git pull origin main
> 
> git checkout -b hotfix/fix-login-crash
> 
> **2.** 修復登入崩潰問題
> 
> git add lib/screens/login_screen.dart
> 
> git commit -m "fix(login): 修復登入時的崩潰問題"
> 
> **3.** 添加測試用例
> 
> git add test/login_screen_test.dart
> 
> git commit -m "add(login): 為登入崩潰問題修復添加測試用例"
> 
> **4.** 合併 **hotfix** 分支
> 
> git checkout main
> 
> git merge hotfix/fix-login-crash
> 
> git push origin main
> 
> git checkout develop
> 
> git merge hotfix/fix-login-crash
> 
> git push origin develop
> 

**UI/UX 規範：**

- 使用Figma設計
- Invite team members for instant communication (無齡診所成員)
- 交付raw data (.fig, 向量圖....等)

**頁面功能文件：[連結](https://docs.google.com/spreadsheets/d/1B1r2tLhK41xS1RSBLGmWuq-pdEtAD-E8XT8UTLn1qP4/edit?usp=sharing)
SiteMap : [連結](https://drive.google.com/drive/folders/1SQFpJsd18zGefuWPiXMRUjm994yX_QhO?usp=sharing)
CMS內容清單 : [連結](https://docs.google.com/spreadsheets/d/1BsFZLCETEsXhY6Vw8Z3q_P-nlr72gR-s_yFu9lHOCG0/edit?gid=0#gid=0)
現有後台系統截圖 : [連結](https://drive.google.com/drive/folders/1ODlSJocvESAzxebjgf1mS-obNSv8wlB_?usp=sharing)
手繪稿 : [連結](https://drive.google.com/drive/folders/1EppUKHaSbhpcg-pJ3SBNx-EIsKi5cpoO?usp=sharing)
電子病例 : 依需求訪談設計功能，並且於開發該功能前提供ISO27001認證以供衛生局登記備查**

**外包要求：**

- 需要git repo access as collaborators from initial(可以跟code)維護：1 年
- 提供所有原始碼，包括伺服器、Web、App…等。
- 提供設定和編譯過程的詳細信息，確保無齡診所-self 可重現。
- 保證所有設計不侵犯版權。
- 設計版權歸無齡診所所有。

# 

# 開發時程：

![](%E7%84%A1%E9%BD%A1%E8%A8%BA%E6%89%80IT%E7%B3%BB%E7%B5%B1%E8%A8%AD%E8%A8%88%E8%A6%8F%E6%A0%BC%E6%9B%B8(%E5%90%88%E7%B4%84%E7%89%88)%202523fc05b3bc8086a16bdbb97ba86f3e/image4.jpg)

## 

## 

## 

## **聯絡人信息**

- **專案負責人**：Peter Hsu
- **聯絡方式**：peter.hsu@4plus2r.com